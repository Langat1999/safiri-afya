name: CD

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    needs: [build-and-test] # Assuming CI workflow is named 'build-and-test' or similar, but for now independent.
    # In a real scenario, we'd want to ensure CI passes first. 
    # Since this is a separate file, we can't directly 'need' a job from another workflow easily without reusable workflows.
    # For simplicity, we'll just run on push to main.

    steps:
    - uses: actions/checkout@v4

    - name: Deploy to Vercel (Frontend)
      uses: amondnet/vercel-action@v20
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.ORG_ID}}
        vercel-project-id: ${{ secrets.PROJECT_ID}}
        working-directory: ./
        vercel-args: '--prod'

    - name: Deploy to Vercel (Backend)
      uses: amondnet/vercel-action@v20
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.ORG_ID}}
        vercel-project-id: ${{ secrets.BACKEND_PROJECT_ID}}
        working-directory: ./backend
        vercel-args: '--prod'
